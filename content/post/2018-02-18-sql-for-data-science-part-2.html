---
title: SQL for Data Science - Part 2
author: ''
date: '2017-12-25'
slug: sql-for-data-science-part-2
categories:
  - database
tags:
  - sql
  - sqlite
draft: true
---



<p><a href="https://twitter.com/login?redirect_after_login=%2Fhome%3Fstatus"><img src="http://i.imgur.com/tXSoThF.png" alt="Twitter" /></a>
<a href="https://www.facebook.com/sharer/sharer.php?u="><img src="http://i.imgur.com/P3YfQoD.png" alt="Facebook" /></a></p>
<div id="introduction" class="section level4">
<h4>Introduction</h4>
<p>This is the fourth post in the series <strong>R &amp; Databases</strong>. You can find the links to the other two posts of this series below:</p>
<ul>
<li><a href="https://rsquaredacademy.github.io/blog/post/quick-guide-r-sqlite/">Quick Guide: R &amp; SQLite</a></li>
<li><a href="https://rsquaredacademy.github.io/blog/post/data-wrangling-with-dbplyr">Data Wrangling with dbplyr</a></li>
<li><a href="https://rsquaredacademy.github.io/blog/post/sql-for-data-science-part-1">SQL for Data Science - Part 1</a></li>
</ul>
<p>In this post, we will learn to:</p>
</div>
<div id="libraries-code-data" class="section level3">
<h3>Libraries, Code &amp; Data</h3>
<p>We will use the following libraries in this post:</p>
<ul>
<li><a href="http://readr.tidyverse.org/">DBI</a></li>
<li><a href="https://rstats-db.github.io/RSQLite/">RSQLite</a></li>
<li><a href="http://dbplyr.tidyverse.org/">dbplyr</a></li>
</ul>
<p>All the data sets used in this post can be found <a href="https://github.com/rsquaredacademy/datasets">here</a> and code can be downloaded from <a href="https://gist.github.com/rsquaredacademy/691dba8e13873c648bfdb91aba65d4d7">here</a>.</p>
<div id="set-up" class="section level4">
<h4>Set Up</h4>
<pre class="r"><code>ecom &lt;- readr::read_csv(&#39;https://raw.githubusercontent.com/rsquaredacademy/datasets/master/web.csv&#39;)
con &lt;- DBI::dbConnect(RSQLite::SQLite(), &quot;:memory:&quot;)
copy_to(con, ecom)</code></pre>
</div>
<div id="aggregate---1" class="section level4">
<h4>Aggregate - 1</h4>
<p>You can probably guess what the MIN function does! Now itâ€™s your turn to try out some SQL functions.</p>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT SUM(n_visit) FROM ecom&quot;)</code></pre>
<pre><code>##   SUM(n_visit)
## 1         4972</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT AVG(n_visit) FROM ecom&quot;)</code></pre>
<pre><code>##   AVG(n_visit)
## 1        4.972</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MAX(n_visit) FROM ecom&quot;)</code></pre>
<pre><code>##   MAX(n_visit)
## 1           10</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MIN(n_visit) FROM ecom&quot;)</code></pre>
<pre><code>##   MIN(n_visit)
## 1            0</code></pre>
</div>
<div id="aggregate---2" class="section level4">
<h4>Aggregate - 2</h4>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT SUM(n_visit) FROM ecom WHERE n_visit &gt; 5&quot;)</code></pre>
<pre><code>##   SUM(n_visit)
## 1         3574</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT AVG(n_visit) FROM ecom WHERE country LIKE &#39;P%&#39;&quot;)</code></pre>
<pre><code>##   AVG(n_visit)
## 1     5.079137</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MAX(n_visit) FROM ecom WHERE device == &#39;tablet&#39;&quot;)</code></pre>
<pre><code>##   MAX(n_visit)
## 1           10</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MIN(n_visit) FROM ecom WHERE duration BETWEEN 600 AND 900&quot;)</code></pre>
<pre><code>##   MIN(n_visit)
## 1            0</code></pre>
</div>
<div id="alias---part-2" class="section level4">
<h4>Alias - Part 2</h4>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT AVG(n_visit) AS avg_mobile FROM ecom WHERE device == &#39;mobile&#39;&quot;)</code></pre>
<pre><code>##   avg_mobile
## 1   5.479651</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MAX(n_visit) AS max_visit FROM ecom&quot;)</code></pre>
<pre><code>##   max_visit
## 1        10</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT MIN(duration) AS min_duration FROM ecom&quot;)</code></pre>
<pre><code>##   min_duration
## 1           10</code></pre>
</div>
<div id="order-by" class="section level4">
<h4>Order By</h4>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT * FROM ecom ORDER BY country&quot;)</code></pre>
<pre><code>##        id referrer device bouncers n_visit n_pages duration
## 1     232   social laptop    false       8       2       60
## 2     299    yahoo laptop    false      10      18      180
## 3     570   social laptop     true       2       1      274
## 4     677   direct tablet     true      10       1      682
##                               country purchase order_items order_value
## 1                         Afghanistan    false           0           0
## 2                         Afghanistan    false           0           0
## 3                         Afghanistan    false           0           0
## 4                         Afghanistan    false           0           0
##  [ reached getOption(&quot;max.print&quot;) -- omitted 996 rows ]</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT * FROM ecom ORDER BY duration&quot;)</code></pre>
<pre><code>##        id referrer device bouncers n_visit n_pages duration
## 1     236    yahoo tablet     true       5       1       10
## 2     615   social laptop     true       1       1       10
## 3     392    yahoo laptop    false       0       1       12
## 4     688   social mobile     true       2       1       12
##                               country purchase order_items order_value
## 1                              Poland    false           0           0
## 2                             Finland    false           0           0
## 3                           Indonesia    false           0           0
## 4                            Botswana    false           0           0
##  [ reached getOption(&quot;max.print&quot;) -- omitted 996 rows ]</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT * FROM ecom ORDER BY n_visit DESC&quot;)</code></pre>
<pre><code>##        id referrer device bouncers n_visit n_pages duration
## 1       1   google laptop     true      10       1      693
## 2       7    yahoo mobile     true      10       1       75
## 3       8   direct mobile     true      10       1      908
## 4      29   google mobile     true      10       1      338
##                               country purchase order_items order_value
## 1                      Czech Republic    false           0           0
## 2                          Bangladesh    false           0           0
## 3                           Indonesia    false           0           0
## 4                              Russia    false           0           0
##  [ reached getOption(&quot;max.print&quot;) -- omitted 996 rows ]</code></pre>
</div>
<div id="group-by---practice" class="section level4">
<h4>Group By - Practice</h4>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT device, count(*) AS visits FROM ecom GROUP BY device ORDER by visits DESC &quot;)</code></pre>
<pre><code>##   device visits
## 1 mobile    344
## 2 tablet    331
## 3 laptop    325</code></pre>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT device, MAX(duration) AS max_duration FROM ecom GROUP BY device ORDER by max_duration DESC &quot;)</code></pre>
<pre><code>##   device max_duration
## 1 tablet          999
## 2 laptop          997
## 3 mobile          994</code></pre>
</div>
<div id="having" class="section level4">
<h4>Having</h4>
<pre class="r"><code>dbGetQuery(con, &quot;SELECT country FROM ecom GROUP BY country HAVING COUNT(*) &gt; 10&quot;)</code></pre>
<pre><code>##           country
## 1       Argentina
## 2          Brazil
## 3           China
## 4        Colombia
## 5  Czech Republic
## 6          France
## 7          Greece
## 8       Indonesia
## 9           Japan
## 10           Peru
## 11    Philippines
## 12         Poland
## 13       Portugal
## 14         Russia
## 15         Sweden
## 16       Thailand
## 17        Ukraine
## 18  United States</code></pre>
</div>
<div id="putting-it-all-together" class="section level4">
<h4>Putting It All Together</h4>
<p>Compute AOV by devices</p>
</div>
</div>
<div id="summary" class="section level3">
<h3>Summary</h3>
</div>
